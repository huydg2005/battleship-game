<!-- Background video -->
<div class="background-video">
  <video autoplay muted loop>
    <source src="assets/video.mp4" type="video/mp4" />
  </video>
</div>

<!-- Container ch√≠nh -->
<div class="container prepare-container">
  <!-- Sidebar b√™n tr√°i -->
  <aside class="sidebar">
    <!-- Logo + Th√¥ng tin ph√≤ng -->
    <div class="card">
      <div class="logo-box">
        <div class="logo">üö¢</div>
        <div class="title-block">
          <h1 class="title">BATTLESHIP</h1>
          <p class="subtitle">Giai ƒëo·∫°n: Chu·∫©n b·ªã</p>
        </div>
        <div class="room-info">
          <p class="label">Ph√≤ng</p>
          <p class="room-code">{{ roomId }}</p>
        </div>
      </div>
    </div>

    <!-- H∆∞·ªõng d·∫´n -->
    <div class="card">
      <h2>Thao t√°c</h2>
      <hr class="card-divider" />
      <ul>
        <li>K√©o th·∫£ t√†u v√†o l∆∞·ªõi ƒë·ªÉ ƒë·∫∑t v·ªã tr√≠.</li>
        <li>Nh·∫•n ph√≠m <b>R</b> ho·∫∑c n√∫t ‚Üª ƒë·ªÉ xoay ngang/d·ªçc.</li>
        <li>T√†u ch·ªâ ƒë∆∞·ª£c ƒë·∫∑t khi h·ª£p l·ªá.</li>
      </ul>
    </div>

    <!-- Danh s√°ch t√†u -->
    <div class="card">
      <h2>Danh s√°ch t√†u</h2>
      <div class="fleet">
        <div
          class="ship-piece"
          *ngFor="let ship of shipsToPlace"
          [ngClass]="{ placed: isShipPlaced(ship.type) }"
          draggable="true"
          (dragstart)="startDrag(ship.type)"
          (dragend)="cancelDrag()"
        >
          <img
            [src]="getShipImage(ship.type)"
            [alt]="ship.type"
            class="ship-icon"
          />
          <span class="ship-size">({{ ship.length }} √¥)</span>
          <span class="status">
            {{ isShipPlaced(ship.type) ? '‚úÖ' : '‚Äî' }}
          </span>
        </div>
      </div>
    </div>
  </aside>

  <!-- Main b√™n ph·∫£i -->
  <main class="main">
    <!-- Thanh c√¥ng c·ª• -->
    <div class="toolbar">
      <button (click)="rotateDirection()">‚Üª Xoay</button>
      <button (click)="placeRandomShips()"> ƒê·∫∑t ng·∫´u nhi√™n</button>
      <button (click)="resetGrid()"> X√≥a l∆∞·ªõi</button>
      <div class="direction">
        H∆∞·ªõng hi·ªán t·∫°i:
        <span [ngClass]="direction">
          {{ direction === 'horizontal' ? 'Ngang' : 'D·ªçc' }}
        </span>
      </div>
    </div>

    <!-- L∆∞·ªõi -->
    <div class="card grid-wrapper">
      <h2>L∆∞·ªõi c·ªßa b·∫°n</h2>
      <div class="grid">
        <div
          *ngFor="let cell of grid; let i = index"
          class="grid-cell"
          [id]="'cell-' + i"
          (dragover)="allowDrop($event, i)"
          (drop)="dropShip(i)"
          [ngClass]="{ preview: previewPositions.includes(i) }"
        >
          <!-- N·∫øu cell thu·ªôc v·ªÅ t√†u -->
          <ng-container *ngIf="isCellOccupied(i) as placedShip">
            <div
              *ngIf="placedShip.positions[0] === i"
              class="ship-image-container"
              [style.width]="getShipStyle(placedShip).width"
              [style.height]="getShipStyle(placedShip).height"
            >
              <img
                [src]="getPlacedShipImage(placedShip)"
                [alt]="placedShip.type"
              />
            </div>
          </ng-container>
        </div>
      </div>

      <hr class="divider" />

      <!-- Ti·∫øn ƒë·ªô -->
      <div class="progress">
        ƒê√£ ƒë·∫∑t:
        <span>{{ placedShips.length }}/{{ shipsConfig.length }}</span> t√†u
      </div>
    </div>

    <!-- N√∫t h√†nh ƒë·ªông -->
    <div class="actions">
      <button
        class="ready"
        [disabled]="!allShipsPlaced() || isReady"
        (click)="confirmSetup()"
      >
        ‚úÖ {{ isReady ? 'ƒê√£ s·∫µn s√†ng' : 'S·∫µn s√†ng' }}
      </button>
      <button class="fight" (click)="confirmSetup()" [disabled]="!isReady">
        ‚öîÔ∏è Chi·∫øn ƒë·∫•u
      </button>
    </div>
  </main>
</div>
